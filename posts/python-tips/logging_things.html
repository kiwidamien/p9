<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Damien Martin">
<meta name="dcterms.date" content="2024-10-17">
<meta name="description" content="Giving some of the best logging practices, and clarifying some of the logging confusion.">

<title>p9 - Logging - How to and best practices</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">p9</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">p9</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kiwidamien"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Logging - How to and best practices</h1>
                  <div>
        <div class="description">
          Giving some of the best logging practices, and clarifying some of the logging confusion.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">logging</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Damien Martin </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 17, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#problem" id="toc-problem" class="nav-link active" data-scroll-target="#problem">Problem</a></li>
  <li><a href="#solutions-in-a-hurry" id="toc-solutions-in-a-hurry" class="nav-link" data-scroll-target="#solutions-in-a-hurry">Solutions in a hurry</a>
  <ul class="collapse">
  <li><a href="#i-just-want-something-that-works-for-simple-apps" id="toc-i-just-want-something-that-works-for-simple-apps" class="nav-link" data-scroll-target="#i-just-want-something-that-works-for-simple-apps">I just want something that works for simple apps</a></li>
  <li><a href="#the-better-approach" id="toc-the-better-approach" class="nav-link" data-scroll-target="#the-better-approach">The better approach</a></li>
  </ul></li>
  <li><a href="#understanding-logging" id="toc-understanding-logging" class="nav-link" data-scroll-target="#understanding-logging">Understanding Logging</a>
  <ul class="collapse">
  <li><a href="#a-single-logger" id="toc-a-single-logger" class="nav-link" data-scroll-target="#a-single-logger">A single logger</a></li>
  <li><a href="#the-logging-tree" id="toc-the-logging-tree" class="nav-link" data-scroll-target="#the-logging-tree">The logging tree</a></li>
  <li><a href="#going-back-to-the-initial-problem" id="toc-going-back-to-the-initial-problem" class="nav-link" data-scroll-target="#going-back-to-the-initial-problem">Going back to the initial problem</a></li>
  </ul></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  <li><a href="#advanced-logging" id="toc-advanced-logging" class="nav-link" data-scroll-target="#advanced-logging">Advanced Logging</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="problem" class="level1">
<h1>Problem</h1>
<p>Logging in Python is very flexible, but has some odd defaults that make it non-intuitive to use.</p>
<p>The simplest example is the following code, which goes not print out anything:</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>logger.setLevel(logging.INFO)  <span class="co"># Should print at level logging.INFO and above</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Hello"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See? Nothing printed.</p>
<p>We can try the following solution:</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="st">'example'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>logger.setLevel(logging.INFO)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">'one'</span>)   <span class="co"># nothing printed</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">'two'</span>)  <span class="co"># nothing printed</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">'three'</span>) <span class="co"># prints / logs "three"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:example:three</code></pre>
</div>
</div>
<p>Why is only three printed? We will see why after looking at the next example, which fixes these problems.</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>logging.basicConfig()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>logger.setLevel(logging.DEBUG)  <span class="co"># Should print at level logging.DEBUG and above</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Hello"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Hello</code></pre>
</div>
</div>
<p>The addition of <code>logging.basicConfig()</code> now allows you to set the level in a way that you expect!</p>
<p>The problem is that python has a hierarchical system of handlers, and calling <code>logging.basicConfig()</code> affects the root handler. Logging messages start at the root hander, and it decides whether the logger you are defining even gets to see the message. In our previous example, where we tried to log <code>one</code>, <code>two</code>, and <code>three</code>, the call to <code>logging.info</code> implicitly called the <code>logging.basicConfig()</code>, which then affects the all loggers from here on out. This call is changing <em>the root logging handler</em>, something we will define later on.</p>
<p>To show that this is a change that persists, let’s run the same code sample in the same kernel:</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" data-lst-cap="Same code as above, but now `logging.basicConfig()` has been called"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="st">'example'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>logger.setLevel(logging.INFO)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">'one'</span>)   <span class="co"># nothing printed</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">'two'</span>)  <span class="co"># nothing printed</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">'three'</span>) <span class="co"># prints / logs "three"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:example:one
INFO:example:three</code></pre>
</div>
</div>
</section>
<section id="solutions-in-a-hurry" class="level1">
<h1>Solutions in a hurry</h1>
<section id="i-just-want-something-that-works-for-simple-apps" class="level2">
<h2 class="anchored" data-anchor-id="i-just-want-something-that-works-for-simple-apps">I just want something that works for simple apps</h2>
<p>If you just want to get logging, the basic solution is</p>
<ol type="1">
<li>Call <code>logging.basicConfig()</code> early. This means doing it before other modules!</li>
</ol>
<p>The problems with this approach are: 1. The call to <code>logging.basicConfig()</code> affects the root logger, so all loggigng is affected. This causes noisy libraries to propogate their error messages. 2. The call to <code>logging.basicConfig()</code> is only processed once, so you have to make sure it isn’t called by any of your imports. This also means that your import is going to fight with everyone else’s. It isnt’ a problem if you are all trying to set the level to DEBUG in the basic config.</p>
<p>Calling <code>logging.basicConfig()</code> acts on the root logger, and because logging is handled in a hierarchy (with the root logger at the root), this can make it hard to reason about. There is only one root logger in your application, so you have to be aware of these side affects for not only everything you use, but everything you import.</p>
<p>This <a href="https://stackoverflow.com/questions/57115395/why-does-logger-info-only-appear-after-calling-logging-info/">stackoverflow answer</a> discusses this in more detail.</p>
</section>
<section id="the-better-approach" class="level2">
<h2 class="anchored" data-anchor-id="the-better-approach">The better approach</h2>
<p>A better approach is (from <a href="https://youtu.be/9L77QExPmI0?si=ie9vzv1tq4LR8xGR&amp;t=163">mCoding’s excellent overview</a>)</p>
<ol type="1">
<li>Create a logger for your own script</li>
<li>Leave propogation turned on to the root logger</li>
<li>Put all complicated things (filters, formatters, etc) all on the root logger, not in your custom logger</li>
<li>Use the logger you created, not the root logger, when logging messages. Your logger will propagate to the root logger, which will then use the filters and formatters to “do-the-right-thing” (TM).</li>
</ol>
<p>In code, you might do this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging.config</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="st">"my_app"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>logger_config <span class="op">=</span> {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"version"</span>: <span class="dv">1</span>,  <span class="co"># always 1, allows future updates</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"disable_existing_loggers"</span>: <span class="va">False</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"filters"</span>:{},</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formatters"</span>: {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"simple"</span>: {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"format"</span>: <span class="st">"</span><span class="sc">%(levelname)s</span><span class="st"> </span><span class="sc">%(message)s</span><span class="st">"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"handlers"</span>: {</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"stderr"</span>: {</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"class"</span>: <span class="st">"logging.StreamHandler"</span>,   <span class="co"># Print to screen</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"formatter"</span>: <span class="st">"simple"</span>,              <span class="co"># References a key in the formatters dict</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream"</span>: <span class="st">"ext://sys.stderr"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"loggers"</span>: {</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"root"</span>: {<span class="st">"level"</span>: <span class="st">"DEBUG"</span>, <span class="st">"handlers"</span>: [<span class="st">"stderr"</span>]}   <span class="co"># handlers references a key in handlers dict</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>logging.config.dictConfig(config<span class="op">=</span>logger_config)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># use your logger</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"This is my logger, and is good"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># don't use the root logger directly</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"This is using the root logger, and this is bad"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="understanding-logging" class="level1">
<h1>Understanding Logging</h1>
<p>James Murphy (of mCoding) does an excellent job here of talking about what a logger is and now it works. This is very much inspired by his presentation of it in <a href="https://youtu.be/9L77QExPmI0?si=ie9vzv1tq4LR8xGR&amp;t=163">this video</a></p>
<section id="a-single-logger" class="level2">
<h2 class="anchored" data-anchor-id="a-single-logger">A single logger</h2>
<p>Here are the basic parts of logging:</p>
<ul>
<li><strong>logger</strong>: The is the the thing you make when calling <code>my_logger = getLogger("my_awesome_logger")</code>. The logger is responsible for creating LogRecords, which is a data structure containing the information we want to log. It does this with a variety of methods: <code>my_logger.debug("message")</code> creates a LogRecord with level DEBUG, etc. In addition, a logger contains the following parts:
<ul>
<li>An internal level (numeric, but commonly aliased to DEBUG, INFO, WARNING, ERROR, CRITICAL) for the logger that can be set and changed.</li>
<li>A filter, for determining which records</li>
<li>A collection of handlers (see below)</li>
<li>A propagation flag</li>
</ul></li>
<li><strong>log records</strong>: A log record is recreated when you call <code>my_logger.debug(message)</code>, <code>my_logger.info(message)</code>, etc. It creates a data structure that contains the message you gave it, as well as injecting a collection of metadata (e.g.&nbsp;when the message was called, what module it was called in, what function you were in, what line number you were on, what the level of the message is (debug vs info vs warning vs error vs critical), etc. The various fields you can access are listed in the documentation <a href="https://docs.python.org/3/library/logging.html#logrecord-attributes">here</a>.</li>
<li><strong>formatters</strong>: A way of taking a log record, and turning into a string that can be printed, stored in a file, a database, etc.</li>
<li><strong>handlers</strong>: A handler takes a log record, and decides what to do with it. Each handler typically deals with place to put logs, called a sink. If you wanted to print logs to std out and save them in a file, you would typically have two handlers: one handler for printing to std out, and a separate handler for each. A handler typically has
<ul>
<li>An internal level (numeric, but commonly aliased to DEBUG, INFO, WARNING, ERROR, CRITICAL), just like the logger (this is a source of much confusion)</li>
<li>A filter, for determining if this log record should be handled</li>
<li>A formatter, which takes a log record and turns it into a string. This is the thing that is printed / stored in a file / stored in a database, etc.</li>
<li>A sink: where we put the non-filtered strings we created from <em>log records</em></li>
</ul></li>
</ul>
<p>Here is a graphical representation of a single logger:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logger.png" class="img-fluid figure-img"></p>
<figcaption>Structure of a Logger (mCoding inspired)</figcaption>
</figure>
</div>
<p>When you call <code>my_logger.info("my message")</code>, here is what happens:</p>
<ol type="1">
<li>The logger first checks it’s log level. If it is INFO or lower, then the logger creates the log record. If the logger’s level is INFO or higher, we don’t even make the record.</li>
<li>The logger then creates the LogRecord, which contains the message <code>"my_message"</code>, as well as other meta data (e.g.&nbsp;when the LogRecord was created, the module/function/line number of the call, etc).</li>
<li>The logger then checks if the LogRecord should be filtered out. It has access to all the data in the log record, not just the level. If it should be filtered out, we stop here.</li>
<li>The logger then passes the LogRecord to each handler. Each handler now goes through a similar set of steps:
<ul>
<li>Each handler checks <em>it’s</em> level, to see if it is INFO or lower. The handler stops if it’s level is higher than INFO.</li>
<li>Each handler with level INFO or below sees if it should filter out this message (e.g.&nbsp;some records might be okay to go on a screen, but not saved to disk)</li>
<li>For each handler with level INFO or below, that didn’t filter out the message, then formats the message, and sends it to it’s sink.</li>
</ul></li>
<li>The LogRecord is then propagated on to the parent logger of this logger (!!).
<ul>
<li>If <code>my_logger</code> rejects the LogRecord, we stop on steps 1 or 3 – we never get here. Being rejected by the logger means no propagation.</li>
<li>If <code>my_logger</code> doesn’t reject the LogRecord, we do this step after all the handlers for <code>my_logger</code> – even if every handler for <code>my_logger</code> rejected the message.</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here are a couple of “gotchas”</p>
<ul>
<li><p>If you have a <em>handler</em> with a level of DEBUG, but the logger has a higer level (e.g.&nbsp;INFO), you won’t see any DEBUG messages. This is because the logger is dropping the messages before the handler gets a chance to see it.</p></li>
<li><p>If you have a logger that drops a message (by level or filter), it will <em>not</em> be propagated to other loggers.</p></li>
<li><p>If the logger doesn’t drop a message, it will be propagated, even if no logger handles it.</p></li>
</ul>
</div>
</div>
<p>The reason for this is if you wanted to block messages from Pandas, you only have to manipulate the logger to block at the logger e.g.&nbsp;to block Pandas DEBUG messages while keeping INFO and higher, but keep debug messages from your application, you would only need to set the LEVEL on the pandas logger to INFO, and the logger for your application to DEBUG.</p>
<p>So in addition to multiple handlers, we also have multiple <em>loggers</em>. Let’s deal with that next.</p>
</section>
<section id="the-logging-tree" class="level2">
<h2 class="anchored" data-anchor-id="the-logging-tree">The logging tree</h2>
<p>When you type <code>import logging</code> into your application, you get a <em>root</em> logger. Any other logger you create is a descendent of this root.</p>
<p>When you call <code>logging.getLogger("silly_logger")</code>, then Python will create a logger object called <code>"silly_logger"</code> if it doesn’t exist; once the logger exists it will be returned. You will only have logger called <code>"silly_logger"</code> at any time in your program. This logger will (by default) pass any message it doesn’t drop on to the root logger.</p>
<p>When you call <code>logging.getLogger("my_app.X.awesome_logger")</code>, you get the three loggers (either returning them if they exist, or creating them): * <code>my_app</code> * <code>my_app.X</code> * <code>my_app.X.awesome_logger</code> and a link to the <code>my_app.X.awesome_logger</code> is returned. Each one of these loggers propagates any non-dropped messages up the chain to the next logger, with the <code>my_app</code> logger propagating to the root.</p>
<p>As a diagram, we have</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
  AWESOME[my_app.X.awesome_logger] --&gt; MAX[my_app.X] --&gt; MA[my_app] --&gt; Root
  S[silly_logger] --&gt; Root

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="{callout-info}">
<p>It is possible to change loggers so they don’t propagate upward, but by default they do. Because it is very common for imports to have their own loggers, you should assume that the root logger will have messages passed to it, even if you turn propagation off in your loggers.</p>
</div>
</section>
<section id="going-back-to-the-initial-problem" class="level2">
<h2 class="anchored" data-anchor-id="going-back-to-the-initial-problem">Going back to the initial problem</h2>
<p>When we started this article, we looked at a simple problem of why logging didn’t work until the root logger or <code>basicConfig</code> was called. Let’s look at it again</p>
<div id="cell-24" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">import</span> logging</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>logger <span class="op">=</span> logging.getLogger(<span class="st">'test'</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>logger.setLevel(logging.DEBUG)</span>
<span id="cb9-5"><a href="#cb9-5"></a>logger.info(<span class="st">"This should be seen, but won't be"</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>logger.warning(<span class="st">"This will be seen"</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a>logger.info(<span class="st">"But this won't be"</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co"># Now use the root logger</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>logging.info(<span class="st">"Hi"</span>)</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>logger.info(<span class="st">"Bye!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What we get out is just</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>This will be seen</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>INFO:test:Bye<span class="op">!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The order of events are roughly:</p>
<ul>
<li>Line 3: We make a new logger called <code>test</code>. This logger does not have any handlers. The root logger <em>does</em> have a handler, which prints to standard error, and WARNING or higher by default.</li>
<li>Line 4: We set the warning level of the <code>test</code> logger to DEBUG.</li>
<li>Line 5: We send the <code>test</code> logger an INFO message.
<ul>
<li>It accepts it, but has no handlers. It makes a log record, and propagates on to the root logger.</li>
<li>The root logger has a default level of WARNING, and ignores this message.</li>
</ul></li>
<li>Line 6: We sent the <code>test</code> logger a WARNING message.
<ul>
<li>It accepts it, but has not handlers. It makes a log record, and propagates on to the root logger.</li>
<li>The root logger has a default level of WARNING, so it will handle this message.</li>
<li>The root logger’s default formatter just prints the message</li>
</ul></li>
<li>Line 7: We sent the <code>test</code> logger an INFO message.
<ul>
<li>Same as line 5, it passes the LogRecord onto the root logger, and the root logger ignores it.</li>
</ul></li>
<li>Line 10: We send the <em>root</em> logger its first message directly (rather than it being passed). Or more precisely, we are calling <code>info</code> in the logging module.
<ul>
<li>You can see from the <a href="https://github.com/python/cpython/blob/ded105a62b9d78717f8dc64652e3903190b585dd/Lib/logging/__init__.py#L2187">code in Github</a>, this sees we have no root configured yet, so it calls <code>basicConfig()</code>.</li>
<li>From the docstring of <code>basicConfig()</code> you can see it does nothing, unless we don’t have handlers for the root logger.</li>
<li>In that case, it will add one (a stream), set a basic format string with a bit more information, and not require a level anymore.</li>
</ul></li>
<li>Line 12: We send the <code>test</code> logger an INFO message.
<ul>
<li>It accepts it, but has no handlers. It propagates it to the root logger.</li>
<li>The root logger now accepts any level after the <code>basicConfig()</code>, and has the formatter updated. From the LogRecord, it produces <code>INFO:test:Bye!</code></li>
</ul></li>
</ul>
<p>If this code is in a Jupyter notebook and you ran in again, you would have different output, precisely because the root logger has already been configured.</p>
</section>
</section>
<section id="recommendations" class="level1">
<h1>Recommendations</h1>
<p>With multiple layers of loggers and handlers, it is easy to see how messages could get lost or repeated. Here are some recommendations take from James Murphy’s mCoding video:</p>
<ol type="1">
<li>Don’t use the root logger, make your own.</li>
<li>You don’t need a logger for every file, just make one for your app.</li>
<li>Call DictConfig on your logger, to explicitly set up what you want the handlers, filters, and formatters to be</li>
<li>Put all handlers, filters, and formatters on the root logger, not your own logger(s). Just let everything propagate up to the root, and then deal with it there (slight exception if using a QueueHandler)</li>
</ol>
</section>
<section id="advanced-logging" class="level1">
<h1>Advanced Logging</h1>
<p>The first thing you should do is watch the mCoding video mentioned a few times already. It has some examples of setting up a rotating file handler, and a queue handler (which I will go into more detail on below).</p>
<p>Beyong that, there are lots of different configuration “recipes” that you can find in the <a href="https://docs.python.org/3/howto/logging-cookbook.html">Python Logging Cookbook</a>.</p>
<p>The Queue handler is interesting, because the idea is that logging posts to a queue. The queue is processed by a worker in another thread, so that if your log involves an expensive IO operation (TBC)</p>


</section>

</main> <!-- /main -->
<div>
    <hr>
    
    <h4> Stay in touch </h4>
    
    <hr>
    </div>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kiwidamien\.github\.io\/p9");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>